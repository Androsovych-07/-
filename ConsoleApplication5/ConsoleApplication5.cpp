#include <iostream>
#include <fstream>
#include <string>
#include <iomanip>
#include <algorithm>
#include <windows.h>

using namespace std;

struct Товар {
    string назва;
    string виробник;
    int привезено;
    int продано;
    int залишок; 
    double ціна;

    void оновитиЗалишок() {
        залишок = привезено - продано;
    }
};

void додатиТовар(Товар*&, int&, int&);
void видалитиТовар(Товар*&, int&, int&);
void показатиТовари(const Товар*, int);
void знайтиТовар(const Товар*, int);
void редагуватиТовар(Товар*, int);
void сортуватиТовари(Товар*, int);
void записатиУФайл(const Товар*, int);
void завантажитиЗФайлу(Товар*&, int&, int&);

int main() {
    SetConsoleCP(1251);
    SetConsoleOutputCP(1251);

    Товар* товари = nullptr;
    int кількістьТоварів = 0;
    int максимальнийРозмір = 10; 

    товари = new Товар[максимальнийРозмір];
    завантажитиЗФайлу(товари, кількістьТоварів, максимальнийРозмір);

    int вибір;
    do {
        cout << "\n=============================================\n";
        cout << " Управління складом побутової техніки\n";
        cout << "=============================================\n\n";
        cout << "1. Додати товар\n\n";
        cout << "2. Видалити товар\n\n";
        cout << "3. Показати всі товари\n\n";
        cout << "4. Знайти товар\n\n";
        cout << "5. Редагувати товар\n\n";
        cout << "6. Сортувати товари\n\n";
        cout << "7. Записати дані у файл\n\n";
        cout << "8. Завантажити дані з файлу\n\n";
        cout << "9. Вихід\n\n";
        cout << "Ваш вибір: ";
        cin >> вибір;

        switch (вибір) {
        case 1:
            додатиТовар(товари, кількістьТоварів, максимальнийРозмір);
            break;
        case 2:
            видалитиТовар(товари, кількістьТоварів, максимальнийРозмір);
            break;
        case 3:
            показатиТовари(товари, кількістьТоварів);
            break;
        case 4:
            знайтиТовар(товари, кількістьТоварів);
            break;
        case 5:
            редагуватиТовар(товари, кількістьТоварів);
            break;
        case 6:
            сортуватиТовари(товари, кількістьТоварів);
            break;
        case 7:
            записатиУФайл(товари, кількістьТоварів);
            break;
        case 8:
            завантажитиЗФайлу(товари, кількістьТоварів, максимальнийРозмір);
            break;
        case 9:
            cout << "Програма завершена.\n";
            break;
        default:
            cout << "Неправильний вибір. Спробуйте ще раз.\n";
        }
        system("pause");
    } while (вибір != 9);

    delete[] товари;
    return 0;
}

void додатиТовар(Товар*& товари, int& кількість, int& максимальнийРозмір) {
    if (кількість >= максимальнийРозмір) {
        максимальнийРозмір *= 2;
        Товар* новийМасив = new Товар[максимальнийРозмір];
        for (int i = 0; i < кількість; i++) {
            новийМасив[i] = товари[i];
        }
        delete[] товари;
        товари = новийМасив;
    }

    cout << "Введіть назву товару: ";
    cin.ignore();
    getline(cin, товари[кількість].назва);
    cout << "Введіть виробника: ";
    getline(cin, товари[кількість].виробник);
    cout << "Введіть кількість привезеного: ";
    cin >> товари[кількість].привезено;
    cout << "Введіть кількість проданого: ";
    cin >> товари[кількість].продано;
    cout << "Введіть ціну: ";
    cin >> товари[кількість].ціна;

    товари[кількість].оновитиЗалишок();
    кількість++;
    cout << "Товар успішно додано!\n";
}

void видалитиТовар(Товар*& товари, int& кількість, int& максимальнийРозмір) {
    if (кількість == 0) {
        cout << "Склад порожній, немає товарів для видалення.\n";
        return;
    }

    cout << "Введіть номер товару для видалення (1-" << кількість << "): ";
    int номер;
    cin >> номер;

    if (номер < 1 || номер > кількість) {
        cout << "Неправильний номер товару.\n";
        return;
    }

    for (int i = номер - 1; i < кількість - 1; i++) {
        товари[i] = товари[i + 1];
    }

    кількість--;
    cout << "Товар успішно видалено.\n";
}

void показатиТовари(const Товар* товари, int кількість) {
    if (кількість == 0) {
        cout << "Склад порожній.\n";
        return;
    }

    cout << left << setw(20) << "Назва"
        << setw(20) << "Виробник"
        << setw(20) << "Привезено"
        << setw(20) << "Продано"
        << setw(20) << "Залишок"
        << setw(20) << "Ціна" << endl;

    for (int i = 0; i < кількість; i++) {
        cout << left << setw(20) << товари[i].назва
            << setw(20) << товари[i].виробник
            << setw(20) << товари[i].привезено
            << setw(20) << товари[i].продано
            << setw(20) << товари[i].залишок
            << setw(20) << fixed << setprecision(2) << товари[i].ціна << endl;
    }
}

void знайтиТовар(const Товар* товари, int кількість) {
    if (кількість == 0) {
        cout << "Склад порожній.\n";
        return;
    }

    cout << "Введіть назву товару для пошуку: ";
    cin.ignore();
    string запит;
    getline(cin, запит);

    bool знайдено = false;
    for (int i = 0; i < кількість; i++) {
        if (товари[i].назва == запит) {
            знайдено = true;
            cout << left << setw(20) << "Назва"
                << setw(20) << "Виробник"
                << setw(20) << "Привезено"
                << setw(20) << "Продано"
                << setw(20) << "Залишок"
                << setw(20) << "Ціна" << endl;
            cout << left << setw(20) << товари[i].назва
                << setw(20) << товари[i].виробник
                << setw(20) << товари[i].привезено
                << setw(20) << товари[i].продано
                << setw(20) << товари[i].залишок
                << setw(20) << fixed << setprecision(2) << товари[i].ціна << endl;
            break;
        }
    }

    if (!знайдено) {
        cout << "Товар із назвою \"" << запит << "\" не знайдено.\n";
    }
}

void редагуватиТовар(Товар* товари, int кількість) {
    if (кількість == 0) {
        cout << "Склад порожній.\n";
        return;
    }

    cout << "Введіть номер товару для редагування (1-" << кількість << "): ";
    int номер;
    cin >> номер;

    if (номер < 1 || номер > кількість) {
        cout << "Неправильний номер товару.\n";
        return;
    }

    номер--; 
    cout << "Редагування товару \"" << товари[номер].назва << "\":\n";

    cout << "Введіть нову назву (або залиште порожнім для збереження поточної): ";
    cin.ignore();
    string новаНазва;
    getline(cin, новаНазва);
    if (!новаНазва.empty()) {
        товари[номер].назва = новаНазва;
    }

    cout << "Введіть нового виробника (або залиште порожнім): ";
    string новийВиробник;
    getline(cin, новийВиробник);
    if (!новийВиробник.empty()) {
        товари[номер].виробник = новийВиробник;
    }

    cout << "Введіть нову кількість привезеного (або -1 для збереження поточного): ";
    int новеПривезено;
    cin >> новеПривезено;
    if (новеПривезено >= 0) {
        товари[номер].привезено = новеПривезено;
    }

    cout << "Введіть нову кількість проданого (або -1 для збереження поточного): ";
    int новеПродано;
    cin >> новеПродано;
    if (новеПродано >= 0) {
        товари[номер].продано = новеПродано;
    }

    cout << "Введіть нову ціну (або -1 для збереження поточної): ";
    double новаЦіна;
    cin >> новаЦіна;
    if (новаЦіна >= 0) {
        товари[номер].ціна = новаЦіна;
    }

    товари[номер].оновитиЗалишок();
    cout << "Товар успішно оновлено.\n";
}

void сортуватиТовари(Товар* товари, int кількість) {
    if (кількість == 0) {
        cout << "Склад порожній.\n";
        return;
    }

    cout << "Оберіть критерій сортування:\n";
    cout << "1. За назвою\n";
    cout << "2. За виробником\n";
    cout << "3. За залишком\n";
    cout << "4. За ціною\n";
    cout << "Ваш вибір: ";
    int вибір;
    cin >> вибір;

    switch (вибір) {
    case 1:
        sort(товари, товари + кількість, [](const Товар& a, const Товар& b) {
            return a.назва < b.назва;
            });
        break;
    case 2:
        sort(товари, товари + кількість, [](const Товар& a, const Товар& b) {
            return a.виробник < b.виробник;
            });
        break;
    case 3:
        sort(товари, товари + кількість, [](const Товар& a, const Товар& b) {
            return a.залишок > b.залишок; 
            });
        break;
    case 4:
        sort(товари, товари + кількість, [](const Товар& a, const Товар& b) {
            return a.ціна < b.ціна;
            });
        break;
    default:
        cout << "Неправильний вибір.\n";
        return;
    }

    cout << "Сортування виконано.\n";
}

void записатиУФайл(const Товар* товари, int кількість) {
    ofstream файл("товари.txt");
    if (!файл) {
        cout << "Помилка запису у файл.\n";
        return;
    }

    файл << кількість << "\n";
    for (int i = 0; i < кількість; i++) {
        файл << товари[i].назва << "\n"
            << товари[i].виробник << "\n"
            << товари[i].привезено << "\n"
            << товари[i].продано << "\n"
            << товари[i].ціна << "\n";
    }

    файл.close();
    cout << "Дані успішно записано у файл.\n";
}

void завантажитиЗФайлу(Товар*& товари, int& кількість, int& максимальнийРозмір) {
    ifstream файл("товари.txt");
    if (!файл) {
        cout << "Файл не знайдено.\n";
        return;
    }

    файл >> кількість;
    файл.ignore();

    if (кількість > максимальнийРозмір) {
        максимальнийРозмір = кількість;
        delete[] товари;
        товари = new Товар[максимальнийРозмір];
    }

    for (int i = 0; i < кількість; i++) {
        getline(файл, товари[i].назва);
        getline(файл, товари[i].виробник);
        файл >> товари[i].привезено;
        файл >> товари[i].продано;
        файл >> товари[i].ціна;
        файл.ignore();

        товари[i].оновитиЗалишок();
    }

    файл.close();
    cout << "Дані успішно завантажено з файлу.\n";
}
